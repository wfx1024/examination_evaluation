<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>修改</title>
    <base th:href="${#request.getContextPath()}+'/'">
    <link rel="stylesheet" href="static/layuiadmin/layui/css/layui.css" media="all">
</head>
<body>
<div class="overViewPage">

    <div class="newsContent newsForm">
        <form class="layui-form" action="" lay-filter="component-form-group2">
            <input type="hidden" name="id" th:value="${textbook?.id}">
            <div class="layui-form-item" style="position: relative">
                <div class="layui-inline newly_adress">
                    <label class="layui-form-label">教材名称</label>
                    <div class="layui-input-inline">
                        <input type="text" name="name" id="name" autocomplete="off" class="layui-input" lay-verify="name" th:value="${textbook?.name}">
                    </div>
                </div>
                <div class="layui-inline newly_adress">
                    <label class="layui-form-label">出版单位</label>
                    <div class="layui-input-inline">
                        <input type="text" name="publisher" id="publisher" autocomplete="off" class="layui-input" lay-verify="publisher" th:value="${textbook?.publisher}">
                    </div>
                </div>
                <div class="layui-inline newly_adress">
                    <label class="layui-form-label">书号</label>
                    <div class="layui-input-inline">
                        <input type="text" name="isbn" id="isbn" autocomplete="off" class="layui-input" lay-verify="isbn" th:value="${textbook?.isbn}">
                    </div>
                </div>
            </div>
            <div class="layui-form-item" style="position: relative">
                <div class="layui-inline">
                    <label class="layui-form-label">版次</label>
                    <div class="layui-input-inline">
                        <input type="text" name="edition" id="edition" autocomplete="off" class="layui-input" th:value="${textbook?.edition}">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">版次日期</label>
                    <div class="layui-input-inline">
                        <input type="text" class="layui-input" id="editionDate" name="editionDate" th:value="${textbook?.editionDate}" placeholder="yyyy-MM">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">再版书第1版版次书名</label>
                    <div class="layui-input-inline">
                        <input type="text" name="nameBack" id="nameBack" autocomplete="off" class="layui-input" th:value="${textbook?.nameBack}">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">再版书第1版版次书号</label>
                    <div class="layui-input-inline">
                        <input type="text" name="isbnBack" id="isbnBack" autocomplete="off" class="layui-input" th:value="${textbook?.isbnBack}">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">再版书第1版版次日期</label>
                    <div class="layui-input-inline">
                        <input type="text" name="editionBack" id="editionBack" autocomplete="off" placeholder="yyyy-MM" class="layui-input" th:value="${textbook?.editionBack}">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">语种</label>
                    <div class="layui-input-inline">
                        <select id="language" name="language" lay-verify="language">
                            <option value="">请选择</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="layui-form-item" style="position: relative">
                <div class="layui-inline">
                    <label class="layui-form-label">教材类型1</label>
                    <div class="layui-input-inline">
                        <select id="textbookType1" name="textbookType1" lay-verify="textbookType1">
                            <option value="">请选择</option>
                        </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">教材类型2</label>
                    <div class="layui-input-inline">
                        <div class="layui-input-inline">
                            <select id="textbookType2" name="textbookType2" lay-verify="textbookType2">
                                <option value="">请选择</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">教材类型3</label>
                    <div class="layui-input-inline">
                        <select id="textbookType3" name="textbookType3" lay-verify="textbookType3">
                            <option value="">请选择</option>
                        </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">教材类型4</label>
                    <div class="layui-input-inline">
                        <select id="textbookType4" name="textbookType4" lay-verify="textbookType4">
                            <option value="">请选择</option>
                        </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">教材类型5</label>
                    <div class="layui-input-inline">
                        <select id="textbookType5" name="textbookType5" lay-verify="textbookType5">
                            <option value="">请选择</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="layui-form-item" style="position: relative">
                <div class="layui-inline">
                    <label class="layui-form-label">教材出版形态</label>
                    <div class="layui-input-inline">
                        <input type="text" name="publishForm" id="publishForm" autocomplete="off"  class="layui-input" th:value="${textbook?.publishForm}" >
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">是否高校</label>
                    <div class="layui-input-inline">
                        <select id="isCollege" name="isCollege">
                            <option value="">请选择</option>
                            <option value="是" th:selected="${textbook?.isCollege=='是'}">是</option>
                            <option value="否" th:selected="${textbook?.isCollege=='否'}">否</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="layui-form-item" style="position: relative">
                <div class="layui-inline">
                    <label class="layui-form-label">主要作者</label>
                    <div class="layui-input-inline">
                        <input type="text" name="author1" id="author1" autocomplete="off"  class="layui-input" th:value="${textbook?.author1}" >
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">著作方式</label>
                    <div class="layui-input-inline">
                        <input type="text" name="authorMode1" id="authorMode1" autocomplete="off"  class="layui-input" th:value="${textbook?.authorMode1}" >
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">作者单位</label>
                    <div class="layui-input-inline">
                        <input type="text" name="authorUnit1" id="authorUnit1" autocomplete="off"  class="layui-input" th:value="${textbook?.authorUnit1}" >
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">国籍</label>
                    <div class="layui-input-inline">
                        <input type="text" name="authorNationality1" id="authorNationality1" autocomplete="off"  class="layui-input" th:value="${textbook?.authorNationality1}" >
                    </div>
                </div>
            </div>
            <div class="layui-form-item" style="position: relative">
                <div class="layui-inline">
                    <label class="layui-form-label">国家级立项情况</label>
                    <div class="layui-input-inline">
                        <input type="text" name="projectSituation" id="projectSituation" autocomplete="off"  class="layui-input" th:value="${textbook?.projectSituation}" >
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">其他立项情况</label>
                    <div class="layui-input-inline">
                        <input type="text" name="otherSituation" id="otherSituation" autocomplete="off"  class="layui-input" th:value="${textbook?.otherSituation}" >
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">国家级获奖情况</label>
                    <div class="layui-input-inline">
                        <input type="text" name="prizeSituation" id="prizeSituation" autocomplete="off"  class="layui-input" th:value="${textbook?.prizeSituation}" >
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">其他获奖情况</label>
                    <div class="layui-input-inline">
                        <input type="text" name="otherPrizeSituation" id="otherPrizeSituation" autocomplete="off"  class="layui-input" th:value="${textbook?.otherPrizeSituation}" >
                    </div>
                </div>
            </div>
            <div class="layui-form-item newly_upload" style="position: relative">
                <div class="layui-inline">
                    <label class="layui-form-label">封面</label>
                    <div class="layui-input-inline layui-upload">
                        <div class="imgList layui-upload-list layui-inline">
                            <p class='uploadItemImg imgDelete'  ><img th:src="@{${textbook?.coverImage}}"><i></i></p>
                        </div>
                        <a href="javascript:void(0)" class="uploadimg">
                            <input type="file" id="file" multiple="multiple"/>
                        </a>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">版权页</label>
                    <div class="layui-input-inline layui-upload">
                        <div class="imgList layui-upload-list layui-inline">
                            <p class='uploadItemImg imgDelete'  ><img  th:src="@{${textbook?.copyrightImage}}"><i></i></p>
                        </div>
                        <a href="javascript:void(0)" class="uploadimg">
                            <input type="file" id="file2" multiple="multiple"/>
                        </a>
                    </div>
                </div>
            </div>
            <div class="layui-form-item newly_end">
                <input class="btn_submit layui-btn"  style="display: none;" type="button" lay-submit="lay-submit" lay-filter="btn-save" id="btn-save" value="确认">
                <input class="btn_cancel layui-btn" style="display: none;"  type="button" id="btn-cancel" value="取消">
            </div>
        </form>
    </div>
</div>

<script th:src="@{static/layuiadmin/layui/layui.js}"></script>
<script>
    const baseUrl = "[[${#servletContext.contextPath}]]";
</script>
<script>
    layui.config({
        base: baseUrl + '/static/layuiadmin/'  //静态资源所在路径
    }).extend({
        index: 'lib/index'  //主模块入口
    }).use(['layer','index','form','table','laydate'], function () {
        var $ = layui.$  //JQuery
            ,layer = layui.layer
            ,form = layui.form
            ,table = layui.table
            ,laydate = layui.laydate
            ,upload = layui.upload;


        form.on('submit(btn-save)', function (data) {
            var field = data.field; //获取提交的字段
            // 参数去空格
            $.each(field, function (k, v) {
                field[k] = $.trim(v);
            });
            $("#btn-save").prop('disabled', true);
            $.ajax({
                type: "POST",
                timeout: 5000,
                dataType: "json",
                url: baseUrl +  "/textbook/save",
                data: field,
                success: function (d) {
                    if(d.code=="0"){
                        parent.layui.table.reload('tbl-book-list'); //重载表格
                        layer.alert('数据保存成功！', {icon: 1}, function (index) {
                            layer.close(index);
                            //提交 Ajax 成功后，关闭当前弹层并重载表格
                            index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                            parent.layer.close(index); //再执行关闭
                        });
                    }else{
                        layer.alert('数据保存失败：'+d.msg, {icon: 2});
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    layer.alert('数据保存失败：' + textStatus, {icon: 2});
                },
                complete: function () {
                    $("#btn-save").prop('disabled', false);
                }
            });
        })
        $('#file').change(function () {
            load = layer.load();
            var files = this.files.length;
            var max_size = 1024 * 1024 * 10;//限制大小1M=1024*1024b
            if (!/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test($('#file').val())) {
                layer.msg("图片类型必须是.gif,jpeg,jpg,png中的一种",{icon:7});
                layer.close(load) //加载完数据
                return false;
            } else {
                for (var i = 0; i < this.files.length; i++) {
                    var itemImgsize = this.files[i].size;
                    if (itemImgsize > max_size) { //太大的图片不展示，小于1024的展示,1024是k

                    } else {
                        layer.close(load);
                        layui.msg("上传成功");
                    }
                }
            }
        });
        $('#file2').change(function () {
            load = layer.load();
            var files = this.files.length;
            var max_size = 1024 * 1024 * 10;//限制大小1M=1024*1024b
            if (!/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test($('#file').val())) {
                layer.msg("图片类型必须是.gif,jpeg,jpg,png中的一种",{icon:7});
                layer.close(load) //加载完数据
                return false;
            } else {
                for (var i = 0; i < this.files.length; i++) {
                    var itemImgsize = this.files[i].size;
                    if (itemImgsize > max_size) { //太大的图片不展示，小于1024的展示,1024是k

                    } else {
                        layer.close(load);
                        layui.msg("上传成功");
                    }
                }
            }
        });

        /*<![CDATA[*/
        var textbookType1 ="[[${textbook?.textbookType1}]]";
        var textbookType2 ="[[${textbook?.textbookType2}]]";
        var textbookType3 ="[[${textbook?.textbookType3}]]";
        var textbookType4 ="[[${textbook?.textbookType4}]]";
        var textbookType5 ="[[${textbook?.textbookType5}]]";
        var language ="[[${textbook?.language}]]";
        /*]]>*/
//年月选择器
        laydate.render({
            elem: '#editionDate'
            ,type: 'month'
        });

        laydate.render({
            elem: '#editionBack'
            ,type: 'month'
        });

        var initPage = function(){
            //初始化下拉框
            var params = {};
            $.ajax({
                type: "POST",
                // timeout: 3000,
                dataType: "json",
                url:baseUrl + "/textbook/type",
                data: params,
                success: function(d){
                    if(d.code=="0"){
                        var select1 = $("#textbookType1");
                        var select2= $("#textbookType2");
                        var select3 = $("#textbookType3");
                        var select4 = $("#textbookType4");
                        var select5 = $("#textbookType5");
                        $.each(d.data, function (i, v) {
                            if (v  == textbookType1) {
                                select1.append("<option selected value='"+v+"'  >"+v+"</option>");
                            } else {
                                select1.append("<option value='"+v+"'  >"+v+"</option>");
                            }

                            if (v  == textbookType2) {
                                select2.append("<option selected value='"+v+"'>"+v+"</option>");
                            } else {
                                select2.append("<option value='"+v+"'>"+v+"</option>");
                            }
                            if (v  == textbookType3) {
                                select3.append("<option selected value='"+v+"'>"+v+"</option>");
                            } else {
                                select3.append("<option value='"+v+"'>"+v+"</option>");
                            }
                            if (v  == textbookType4) {
                                select4.append("<option selected value='"+v+"'>"+v+"</option>");
                            } else {
                                select4.append("<option value='"+v+"'>"+v+"</option>");
                            }
                            if (v  == textbookType5) {
                                select5.append("<option selected value='"+v+"'>"+v+"</option>");
                            } else {
                                select5.append("<option value='"+v+"'>"+v+"</option>");
                            }

                        });
                        form.render("select", "component-form-group2");
                    }else{
                        layer.msg('类型信息获取失败！', {icon: 2});
                    }
                },
                error: function(XMLHttpRequest,textStatus,errorThrown){
                    layer.msg('类型信息获取失败！', {icon: 2});
                },
                complete: function(){
                }
            });

            $.ajax({
                type: "POST",
                // timeout: 3000,
                dataType: "json",
                url: baseUrl +  "/textbook/language",
                data: params,
                success: function(d){
                    if(d.code=="0"){
                        var select = $("#language");
                        $.each(d.data, function (i, v) {
                            if (v == language) {
                                select.append("<option selected value='"+v+"'>"+v+"</option>");
                            } else {
                                select.append("<option value='"+v+"'>"+v+"</option>");
                            }
                        });
                        form.render("select", "component-form-group2");
                    }else{
                        layer.msg('语种信息获取失败！', {icon: 2});
                    }
                },
                error: function(XMLHttpRequest,textStatus,errorThrown){
                    layer.msg('语种信息获取失败！', {icon: 2});
                },
                complete: function(){
                }
            });
        }

        $(function () {
            initPage();
        })

    });
</script>
</body>
</html>